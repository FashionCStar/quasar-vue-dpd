(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"4fc9":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-page",{attrs:{padding:""}},[[r("div",{staticClass:"q-pa-md"},[r("q-table",{attrs:{data:e.monthlyList,columns:"admin"===e.userLevel?e.columns_admin:e.columns,"row-key":"report_date",pagination:e.pagination,filter:e.filter,"binary-state-sort":""},on:{"update:pagination":function(t){e.pagination=t},request:e.getMonthlyList},scopedSlots:e._u([{key:"top",fn:function(){return[r("div",{staticClass:"col-6 row justify-start"},[r("q-btn",{staticClass:"q-mr-xs q-mt-xs",staticStyle:{width:"100px",height:"40px"},attrs:{color:"primary","icon-right":"archive",label:"Export","no-caps":"",dense:""},on:{click:e.exportTable}}),r("q-btn",{staticClass:"q-mr-xs q-mt-xs",staticStyle:{width:"100px",height:"40px"},attrs:{color:"primary",label:"Single Record","no-caps":"",dense:""},on:{click:function(t){return e.goToSingleDetail()}}}),r("q-btn",{staticClass:"q-mr-xs q-mt-xs",staticStyle:{width:"100px",height:"40px"},attrs:{color:"primary",label:"Group Record","no-caps":"",dense:""},on:{click:e.addGroup}})],1),r("div",{staticClass:"col-6 row justify-end"},[r("div",{staticClass:"items-center q-ml-xs"},[r("q-input",{staticClass:"q-mt-xs",staticStyle:{width:"150px"},attrs:{dense:"",debounce:"300",placeholder:"Search"},scopedSlots:e._u([{key:"append",fn:function(){return[r("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}})],1),r("div",{staticClass:"items-center q-ml-xs"},[r("q-input",{staticClass:"q-mt-xs",staticStyle:{width:"151px"},attrs:{dense:"",color:"cyan-7",type:"date"},model:{value:e.fromDate,callback:function(t){e.fromDate=t},expression:"fromDate"}})],1),r("div",{staticClass:"items-center q-ml-xs"},[r("q-input",{staticClass:"q-mt-xs",staticStyle:{width:"151px"},attrs:{dense:"",color:"cyan-7",type:"date"},model:{value:e.endDate,callback:function(t){e.endDate=t},expression:"endDate"}})],1)])]},proxy:!0},{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t},on:{click:function(r){return e.goToSingleDetail(t.row)}}},[r("q-td",{key:"report_date",attrs:{props:t}},[e._v(e._s(t.row.report_date))]),"admin"===e.userLevel?r("q-td",{key:"user_name",attrs:{props:t}},[e._v(e._s(t.row.user.name))]):e._e(),r("q-td",{key:"courier_name",attrs:{props:t}},[e._v(e._s(t.row.courier_name))]),r("q-td",{key:"route_number",attrs:{props:t}},[e._v(e._s(t.row.route_number))]),r("q-td",{key:"option",attrs:{props:t}},[e._v(e._s(t.row.report_no?"Group":"Single"))])],1)]}}])})],1),r("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:e.showDetail,callback:function(t){e.showDetail=t},expression:"showDetail"}},[r("q-card",[r("q-card-section",[r("div",{staticClass:"text-h6"},[e._v(e._s(e.dialogTitle))])]),r("q-separator"),r("q-card-section",{staticClass:"scroll",staticStyle:{"max-height":"50vh"}},[r("q-form",{ref:"selectedRecord",attrs:{model:e.selectedRecord},on:{submit:e.onSubmit}},[r("div",{staticClass:"row justify-between q-col-gutter-md"},[r("div",{staticClass:"col-12"},[e.isNewRecord?r("q-input",{staticClass:"q-mb-xs",attrs:{dense:"",outlined:"",color:"cyan-7",type:"date"},model:{value:e.selectedRecord.report_date,callback:function(t){e.$set(e.selectedRecord,"report_date",t)},expression:"selectedRecord.report_date"}}):e._e(),r("q-select",{staticClass:"q-mb-xs",attrs:{dense:"",label:"Courier",outlined:"","use-input":"","hide-selected":"","fill-input":"",options:e.filteredNames,"option-value":function(e){return null===e?null:e.id},"option-label":function(e){return null===e?"- Null -":e.courier_name},"emit-value":"","map-options":"",color:"cyan-7",behavior:"menu"},on:{filter:e.filterFn},model:{value:e.selectedRecord.courier_id,callback:function(t){e.$set(e.selectedRecord,"courier_id",t)},expression:"selectedRecord.courier_id"}}),r("q-select",{staticClass:"q-mb-xs",attrs:{dense:"",label:"Route",outlined:"","use-input":"","hide-selected":"","fill-input":"",options:e.routes,"option-value":function(e){return null===e?null:e.id},"option-label":function(e){return null===e?"- Null -":e.route_number},"emit-value":"","map-options":"",color:"cyan-7",behavior:"menu"},model:{value:e.selectedRecord.route_id,callback:function(t){e.$set(e.selectedRecord,"route_id",t)},expression:"selectedRecord.route_id"}})],1)]),r("q-separator"),r("q-card-actions",{attrs:{align:"right"}},[r("q-btn",{attrs:{flat:"",label:"Cancel",color:"primary"},on:{click:e.cancelDetail}}),r("q-btn",{attrs:{flat:"",label:"Save",color:"primary",type:"submit"}})],1)],1)],1)],1)],1)]],2)},i=[],o=(r("7f7f"),r("967e")),n=r.n(o),s=(r("96cf"),r("28a5"),r("1e53")),c=r("f508"),l=r("bd4c"),d=r("a357");function u(e,t){var r=void 0!==t?t(e):e;return r=void 0===r||null===r?"":String(r),r=r.split('"').join('""'),'"'.concat(r,'"')}var p={name:"MonthlyReportList",components:{},data:function(){return{filter:"",fromDate:"",endDate:"",showDetail:!1,pagination:{sortBy:"report_date",descending:!1,page:1,rowsPerPage:10,rowsNumber:20},columns:[{name:"report_date",required:!0,label:"DATE",align:"left",field:"report_date",sortable:!0},{name:"courier_name",required:!0,label:"COURIER",align:"center",field:"courier_name",sortable:!0},{name:"route_number",required:!0,label:"ROUTE",align:"center",field:"route_number",sortable:!0},{name:"option",required:!0,label:"OPTION",align:"center",field:"option"}],columns_admin:[{name:"report_date",required:!0,label:"DATE",align:"left",field:"report_date",sortable:!0},{name:"user_name",required:!0,label:"MANAGER",align:"center",field:"user_name",sortable:!0},{name:"courier_name",required:!0,label:"COURIER",align:"center",field:"courier_name",sortable:!0},{name:"route_number",required:!0,label:"ROUTE",align:"center",field:"route_number",sortable:!0},{name:"option",required:!0,label:"OPTION",align:"center",field:"option"}],monthlyList:[],selectedRecord:{id:"",report_date:"",report_title:"",courier_id:"",route_id:""},isNewRecord:!1,dialogTitle:"",routes:[],couriers:[],filteredNames:[]}},watch:{fromDate:{handler:function(e,t){},deep:!0},endDate:{handler:function(e,t){},deep:!0}},computed:{userLevel:{get:function(){return this.$store.state.auth.userLevel}}},mounted:function(){this.$store.commit("auth/pageTitle",this.$router.currentRoute.meta.title),this.fromDate=l["a"].formatDate(new Date,"YYYY-MM-DD"),this.endDate=l["a"].formatDate(new Date,"YYYY-MM-DD")},methods:{goToSingleDetail:function(e){return n.a.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.a.awrap(this.getCourierList());case 2:return t.next=4,n.a.awrap(this.getRouteList());case 4:e?e.report_no?this.$router.push({name:"ReportDetail",params:{report_no:e.report_no}}):(this.isNewRecord=!1,this.filteredNames=this.couriers,this.dialogTitle="Edit Record",this.selectedRecord.id=e.id,this.selectedRecord.courier_id=e.courier_id,this.selectedRecord.route_id=e.route_id,this.selectedRecord.report_date=e.report_date):(this.dialogTitle="Add New Record",this.isNewRecord=!0,this.selectedRecord.report_date=l["a"].formatDate(new Date,"YYYY-MM-DD"),this.selectedRecord.courier_id="",this.selectedRecord.route_id=""),this.showDetail=!0;case 6:case"end":return t.stop()}}),null,this)},addGroup:function(){this.$router.push({path:"reports/new"})},cancelDetail:function(){this.showDetail=!1,this.selectedRecord={}},onSubmit:function(){var e,t,r;return n.a.async((function(a){while(1)switch(a.prev=a.next){case 0:if(this.selectedRecord.report_date=l["a"].formatDate(l["a"].addToDate(this.selectedRecord.report_date,{days:1}),"YYYY-MM-DD"),this.selectedRecord.courier_id||(this.selectedRecord.courier_id="RNC"),e={data:this.selectedRecord},this.isNewRecord){a.next=20;break}return e.conditions={id:this.selectedRecord.id},c["a"].show(),a.prev=6,a.next=9,n.a.awrap(s["a"].updateSingleRecord(e));case 9:t=a.sent,c["a"].hide(),console.log("result",t.data),a.next=18;break;case 14:a.prev=14,a.t0=a["catch"](6),c["a"].hide(),console.log("error",a.t0);case 18:a.next=33;break;case 20:return c["a"].show(),a.prev=21,a.next=24,n.a.awrap(s["a"].createSingleRecord(e));case 24:r=a.sent,c["a"].hide(),console.log("result",r.data),a.next=33;break;case 29:a.prev=29,a.t1=a["catch"](21),c["a"].hide(),console.log("error",a.t1);case 33:this.cancelDetail(),this.getMonthlyList({pagination:this.pagination,filter:this.filter}),console.log("selected record",this.selectedRecord);case 36:case"end":return a.stop()}}),null,this,[[6,14],[21,29]])},getRouteList:function(){var e;return n.a.async((function(t){while(1)switch(t.prev=t.next){case 0:return c["a"].show(),t.prev=1,t.next=4,n.a.awrap(s["a"].getRouteList());case 4:e=t.sent,c["a"].hide(),this.routes=e.data.data,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),c["a"].hide();case 12:case"end":return t.stop()}}),null,this,[[1,9]])},getCourierList:function(){var e;return n.a.async((function(t){while(1)switch(t.prev=t.next){case 0:return c["a"].show(),t.prev=1,t.next=4,n.a.awrap(s["a"].getCourierList());case 4:e=t.sent,c["a"].hide(),this.couriers=e.data.data,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),c["a"].hide();case 12:case"end":return t.stop()}}),null,this,[[1,9]])},filterFn:function(e,t,r){var a=this;t((function(){if(""===e)a.filteredNames=[];else{var t=e.toLowerCase();a.filteredNames=a.couriers.filter((function(e){return e.courier_name.toLowerCase().indexOf(t)>-1})),a.filteredNames=a.filteredNames.slice(0,3)}}))},getMonthlyList:function(e){var t,r,a,i,o,d,u,p,h,m,f;return n.a.async((function(g){while(1)switch(g.prev=g.next){case 0:return this.fromDate=l["a"].formatDate(l["a"].addToDate(this.fromDate,{days:1}),"YYYY-MM-DD"),this.endDate=l["a"].formatDate(l["a"].addToDate(this.endDate,{days:1}),"YYYY-MM-DD"),t=e.pagination,r=t.page,a=t.rowsPerPage,i=t.rowsNumber,o=t.sortBy,d=t.descending,u=e.filter,p=0===a?i:a,h=(r-1)*a,m={conditions:{},start:h,numPerPage:p,sortBy:o,descending:d,fromDate:this.fromDate,endDate:this.endDate},u&&(m.conditions.filter=u),c["a"].show(),g.prev=9,g.next=12,n.a.awrap(s["a"].getMonthlyReports(m));case 12:f=g.sent,c["a"].hide(),this.monthlyList=f.data.data,this.monthlyList.forEach((function(e,t){e.index=t+1})),this.pagination.rowsNumber=f.data.totalCount,this.pagination.page=r,this.pagination.rowsPerPage=a,this.pagination.sortBy=o,this.pagination.descending=d,g.next=27;break;case 23:g.prev=23,g.t0=g["catch"](9),c["a"].hide(),console.log("errorrrrrrrrrr",g.t0);case 27:case"end":return g.stop()}}),null,this,[[9,23]])},remove:function(e){var t=this;this.$q.dialog({title:"Confirm",message:"Are you surely remove "+e.report_title+"?",cancel:!0,persistent:!0}).onOk((function(){var r,a;return n.a.async((function(i){while(1)switch(i.prev=i.next){case 0:return r={conditions:{id:e.id}},c["a"].show(),i.prev=2,i.next=5,n.a.awrap(s["a"].removeReport(r));case 5:a=i.sent,c["a"].hide(),console.log("remove result",a),t.$q.notify({color:"positive",position:"top",message:e.report_title+" is removed successfully !"}),t.getReportList({pagination:t.pagination,filter:void 0}),i.next=15;break;case 12:i.prev=12,i.t0=i["catch"](2),c["a"].hide();case 15:case"end":return i.stop()}}),null,null,[[2,12]])})).onCancel((function(){})).onDismiss((function(){}))},exportTable:function(){var e=this,t=[this.columns.map((function(e){return u(e.label)}))].concat(this.monthlyList.map((function(t){return e.columns.map((function(e){return u("function"===typeof e.field?e.field(t):t[void 0===e.field?e.name:e.field],e.format)})).join(",")}))).join("\r\n"),r=Object(d["a"])("table-export.xls",t,"text/csv");!0!==r&&this.$q.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}},created:function(){}},h=p,m=r("2877"),f=r("9989"),g=r("eaac"),b=r("9c40"),v=r("27f9"),w=r("0016"),_=r("bd08"),x=r("db86"),y=r("24e8"),D=r("f09f"),q=r("a370"),R=r("eb85"),C=r("0378"),k=r("ddd8"),S=r("4b7e"),Y=r("eebe"),L=r.n(Y),N=Object(m["a"])(h,a,i,!1,null,null,null);t["default"]=N.exports;L()(N,"components",{QPage:f["a"],QTable:g["a"],QBtn:b["a"],QInput:v["a"],QIcon:w["a"],QTr:_["a"],QTd:x["a"],QDialog:y["a"],QCard:D["a"],QCardSection:q["a"],QSeparator:R["a"],QForm:C["a"],QSelect:k["a"],QCardActions:S["a"]})}}]);